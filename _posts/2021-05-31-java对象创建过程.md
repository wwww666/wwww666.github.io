---
layout:     post
title:     	java对象创建过程
subtitle:    java对象创建过程
date:       2021-05-31
author:     wzk
header-img: img/home-bg-o.jpg
catalog: true
tags:
    - java虚拟机
    - java
---

## 前言

每日学习总结记录


>关键词：java,虚拟机

### java对象创建过程
第一步：类加载检查  
虚拟机遇到一条new指令时，首先去检查这个指令的参数是否能在常量池中定位到这个类的符号引用。
并且检查这个符号引用代表的类是否已经被加载过、解析和初始化过。如果没有，那就必须先执行相应的类加载过程。  
第二步：分配内存  
在类加载检查通过后，接下来虚拟机将为新生对象分配内存。对象所需要的内存大小在类加载完成后便可确定，
为对象分配空间的任务等同于把一块确定大小的内存从java堆中划分出来。分配方式有“指针碰撞”和“空闲列表”两种，
选择那种分配方式由java堆是否规整决定，而java堆是否规整又有所采用的垃圾收集器是否带压缩整理功能决定。  
指针碰撞：对内存规整情况下；用过的内存全部整合到一边，没有用过的内存放到另一边，中间有一个分界值指针，只需要向着
没用过的内存方向将该指针移动对象内存大小位置即可。  
空闲列表：堆内存不规整的情况下；虚拟机会维护一个列表，该列表中会记录哪些内存是可用的，在分配的时候，找一块
足够大的内存块儿来划分给对象实例，最后更新列表记录。  
第三步：初始化零值  
内存分配完成后，虚拟机需要将分配到的内存空间都初始化为零值。这一步操作保证了对象的实例字段在
java代码中可以不赋初始值就直接使用，程序能访问到这些字段的数据类型所对应的零值。  
第四步：设置对象头  
初始化零值完成之后，虚拟机要对对象进行必要的设置，例如这个对象是哪个类的实例、如何才能找到类的元数据信息、
对象的哈希码、对象的GC分代年龄等信息。这些信息存放在对象头中。另外，根据虚拟机当前运行状态的不同，如是否启用偏向锁等，
对象头会有不同的设置方式。  
第五步：执行init方法  
在上面工作都完成之后，从虚拟机的视角来看，一个新的对象已经产生，但从java程序的视角来看，对象创建菜刚开始，<init>方法还没有执行，
所有的字段都还为零。所以一般来说，执行new指令之后会接着执行<init>方法，把对象按照程序员的意愿进行初始化，这样一个真正可用的对象才算完全产生。




 

