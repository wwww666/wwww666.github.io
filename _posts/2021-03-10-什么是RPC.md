---
layout:     post
title:      什么是RPC
subtitle:    RPC
date:       2021-03-10
author:     wzk
header-img: img/home-bg-o.jpg
catalog: true
tags:
    - HDFS
    - 通信
---

## 前言

每日学习总结记录



>关键词：RPC

### 什么是RPC呢
最近在准备大数据研发岗位面试题，碰到HDFS的读写流程，遇到了一个很不起眼的小地方，PRC，针对这个RPC调用又专门了解了一下，
之前对这种小问题一直疏忽，这次就要做到全面深入了解。
RPC（Remote Procedure Call）远程过程调用，简单的理解是一个节点请求另一个节点提供的服务。
本地过程调用：如果需要将本地student对象的age+1，可以实现一个addAge()方法，将student对象传入，
对年龄进行更新之后返回即可，本地方法调用的函数体通过函数指针来指定。
远程过程调用：上述操作的过程中，如果addAge()这个方法在服务端，执行函数的函数体在远程机器上，
如何告诉机器需要调用这个方法呢？首先客户端需要告诉服务器，需要调用的函数，这里函数和进程ID存在一个映射，
客户端远程调用时，需要查一下函数，找到对应的ID，然后执行函数的代码。
客户端需要把本地参数传给远程函数，本地调用的过程中，直接压栈即可，但是在远程调用过程中不再同一个内存里，
无法直接传递函数的参数，因此需要客户端把参数转换成字节流，传给服务端，然后服务端将字节流转换成自身能读取的格式，
是一个序列化和反序列化的过程。
3.数据准备好了之后，如何进行传输？网络传输层需要把调用的ID和序列化后的参数传给服务端，然后把计算好的结果序列化传给客户端，
因此TCP层即可完成上述过程，gRPC中采用的是HTTP2协议。
总结如下：
```
// Client端 
//    Student student = Call(ServerAddr, addAge, student)
1. 将这个调用映射为Call ID。
2. 将Call ID，student（params）序列化，以二进制形式打包
3. 把2中得到的数据包发送给ServerAddr，这需要使用网络传输层
4. 等待服务器返回结果
5. 如果服务器调用成功，那么就将结果反序列化，并赋给student，年龄更新

// Server端
1. 在本地维护一个Call ID到函数指针的映射call_id_map，可以用Map<String, Method> callIdMap
2. 等待客户端请求
3. 得到一个请求后，将其数据包反序列化，得到Call ID
4. 通过在callIdMap中查找，得到相应的函数指针
5. 将student（params）反序列化后，在本地调用addAge()函数，得到结果
6. 将student结果序列化后通过网络返回给Client
```  





 

